# Instalación

```bash
apt updatye && apt install bind9 -y
systemctl status bind9 # Vemos el estado
```

---
# Configuración

```bash
nano /etc/bind/named.conf # Fichero de configuración principal
```

Contiene includes para dividir la configuración en varias partes
```bash
include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.root-hints";
```

---
# Configuración de zona primaria

Para configurar un DNS primario, en el archivo named.conf.local:
```bash
#
zone "example.com" {
        type primary; // zona primaria
        file "/etc/bind/zones/example.com"; // Donde estará el archivo
        allow-transfer {192.168.1.253;}; // IP del dns secundario
        notify yes; // Notifica a los dns secundarios cada vez que un fichero de zona cambia
};
```

El archivo example.com
```bash
$TTL 2d    ; TTL por defecto (tiempo sin actualizarse en cache)
$ORIGIN example.com. ; Dominio base para todos los dns 
; Start of Authority RR defining the key characteristics of the zone (domain)
@         IN      SOA   ns1.example.com. hostmaster.example.com. (
                                2025091500 ; serial number (año, mes, dia, cambios en ese día)
                                12h        ; refresh (tiempo que servidor secundario esperará antes de preguntar al primario si el serial number ha cambiado)
                                15m        ; update retry (si no puede contactar con el secundario, esperará ese tiempo antes de volver a intentarlo)
                                4d         ; expiry (Si un secundario no puede contactar al primario durante este tiempo, dejará de responder consultas para la zona)
                                2h         ; minimum (El TTL por defecto para todos los registros de la zona que no tengan un TTL explícito. También usado para caché de respuestas negativas)
                                )

ns1	IN	A	192.168.1.254
ns2	IN	A	192.168.1.253
@	IN	NS	ns1.example.com.
@	IN	NS	ns2.example.com.
web	IN	A	192.168.1.1
www	IN	CNAME	web.example.com.
wew	IN	CNAME	web.example.com.
```

|Registro|Propósito Principal|Ejemplo de Uso|
|---|---|---|
|**A**|IPv4|Servidores web, APIs|
|**AAAA**|IPv6|Servicios IPv6|
|**CNAME**|Alias|redirecciones, CDNs|
|**NS**|Servidores DNS|Delegación DNS|
|**MX**|Correo electrónico|Servidores de email|
|**TXT**|Texto/Verificación|SPF, DMARC, verificaciones|
|**PTR**|Reverse DNS|Validación de IPs|
```bash
systemctl restart bind9 # Recargamos el servicio
dig @<IP_DNS> <dominio> # Lo usamos para verificar su correcto funcionamiento
```

----
# Configuración de zona secundaria

Para configurar un DNS secundario, en el archivo named.conf
```bash
#
zone "example.com" {
        type secondary; // zona secundaria
        file "/var/cache/bind/example.com.saved"; // Donde estará el archivo
        primaries {192.168.1.254;}; //DNS primario
        allow-transfer { none; }; // Evitar transferencias desde este
};
```

En ocasiones el appmour impide que bind escriba el archivo en la ruta que especifiquemos, por eso debemos poner la por defecto que es /var/cache/bind.

```bash
systemctl restart bind9
rndc retransfer example.com # En caso de que aún no haya transferido el archivo
```

---

# Configuración de zona inversa

en named.conf
```bash
#
zone "1.168.192.in-addr.arpa" {
	type primary;
	file "/etc/bind/zones/example.com.rev";
	allow-transfer {192.168.1.253;};
	notify yes;
};
```

en example.com.rev
```bash
$TTL 2d    ; TTL por defecto (tiempo sin actualizarse en cache)
$ORIGIN 1.168.192.in-addr.arpa. ; Dominio base para todos los dns 
; Start of Authority RR defining the key characteristics of the zone (domain)
@         IN      SOA   ns1.example.com. hostmaster.example.com. (
                                2025091600 ; serial number
                                12h        ; refresh
				15m        ; update retry
				4d         ; expiry
                                2h         ; minimum
                                )

	IN	NS	ns1.example.com. ;
	IN	NS	ns2.example.com. ;

1	IN	PTR	web.example.com. ;
254	IN	PTR	ns1.example.com. ;
253	IN	PTR	ns2.example.com. ;
```

```bash
systemctl restart bind9
# Verificamos configuración
named-checkzone 1.168.192.in-addr.arpa /etc/bind/zones/example.com.rev
dig @localhost -x 192.168.1.1 +short # Comprobamos que funciona
```

---
# Configuración avanzada
## ACLS

En el fichero named.conf
```
acl corpents {
	192.168.1.0/24;
	192.168.0.0/24
};
```

Podemos añadir esas acls que luego se usarán para
```bash
zone "example.com" {
        type secondary; // zona secundaria
        file "/var/cache/bind/example.com.saved"; // Donde estará el archivo
        primaries {corpents;}; //DNS primario
        allow-transfer { none; }; // Evitar transferencias desde este
};
```

Osea es como un alias.

---
# DNSSEC
#### ¿Qué es?
Es una extensión de seguridad que protege ante envenenamiento de cache, limitar el impacto de ataques aleatorios de subdominios.

#### Implementción

En la mayoría de los casos de uso, los usuarios pueden simplemente utilizar la política predeterminada incorporada, que se aplica prácticas DNSSEC actualizadas:
En el archivo named.conf
```bash
zone "example.com" {
        type primary; // zona primaria
        file "/etc/bind/zones/example.com";
        allow-transfer {192.168.1.253;};
        notify yes;
		dnssec-policy default; // Aplicamos dnssec
};
```
